# Railway Environment Variables for QLA Mathematics Platform v3.1.0
# Copy these to Railway's Environment Variables section

# ====================
# ENVIRONMENT
# ====================
NODE_ENV=production

# ====================
# DATABASE (Railway provides DATABASE_URL automatically)
# ====================
# IMPORTANT: Set this to 'disable' for Railway
PGSSL=disable

# ====================
# GOOGLE OAUTH (REQUIRED - MUST UPDATE)
# ====================
# Get these from Google Cloud Console
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret-from-google

# Replace with your actual Railway app URL
OAUTH_CALLBACK_URL=https://your-app-name.up.railway.app/auth/google/callback

# ====================
# DOMAIN RESTRICTION
# ====================
# Only allow emails from this domain
ALLOWED_GOOGLE_DOMAIN=qla.qfschools.qa

# ====================
# SESSION & SECURITY (REQUIRED - MUST UPDATE)
# ====================
# Generate with: openssl rand -hex 32
COOKIE_SECRET=change-this-to-a-secure-random-string-at-least-32-characters-long

# Session name (helps avoid conflicts)
SESSION_NAME=qla_sid

# Session timeout in milliseconds (7 days)
SESSION_TIMEOUT=604800000

# ====================
# RATE LIMITING (FIXED VALUES)
# ====================
# Much more reasonable limits
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX=500
AUTH_RATE_LIMIT_MAX=50

# ====================
# USER ROLES (REQUIRED - MUST UPDATE)
# ====================
# Comma-separated list of teacher emails
TEACHER_EMAILS=teacher1@qla.qfschools.qa,teacher2@qla.qfschools.qa,2ed944@qla.qfschools.qa,2hg662@qla.qfschools.qa

# Comma-separated list of admin emails
ADMIN_EMAILS=admin@qla.qfschools.qa,principal@qla.qfschools.qa,2ed944@qla.qfschools.qa

# ====================
# OPTIONAL FEATURES
# ====================
# Maximum file upload size
MAX_UPLOAD_SIZE=100mb

# CORS allowed origins (leave empty to allow all)
ALLOWED_ORIGINS=

# Debug mode (set to false after fixing issues)
DEBUG=false

# ====================
# GOOGLE CLASSROOM (OPTIONAL)
# ====================
# Only if you want Google Classroom integration
# Service account JSON (paste entire JSON as single line)
GC_SERVICE_ACCOUNT=

# Admin email to impersonate
GC_IMPERSONATE_USER=

# API scopes
GC_SCOPES=https://www.googleapis.com/auth/admin.directory.user.readonly https://www.googleapis.com/auth/classroom.rosters.readonly https://www.googleapis.com/auth/classroom.courses.readonly

# ====================
# DEPLOYMENT CHECKLIST
# ====================
# Before deploying, ensure you have:
# ✓ Set GOOGLE_CLIENT_ID with your actual client ID
# ✓ Set GOOGLE_CLIENT_SECRET with your actual secret
# ✓ Updated OAUTH_CALLBACK_URL with your Railway URL
# ✓ Generated a secure COOKIE_SECRET (use: openssl rand -hex 32)
# ✓ Added teacher emails to TEACHER_EMAILS
# ✓ Added admin emails to ADMIN_EMAILS
# ✓ Set PGSSL=disable (required for Railway)
# ✓ Kept the increased rate limits (500 requests per 15 min)

# ====================
# TROUBLESHOOTING
# ====================
# If you get "too many requests" errors:
#   - Increase RATE_LIMIT_MAX to 1000
#   - Increase AUTH_RATE_LIMIT_MAX to 100
#
# If sessions don't persist:
#   - Run: npm run fix:sessions
#   - Check SESSION_NAME is set to 'qla_sid'
#
# If lessons don't appear:
#   - Run: npm run fix:lessons
#   - Check grade7/ and grade8/ directories exist
#
# If login fails:
#   - Verify OAUTH_CALLBACK_URL matches exactly
#   - Check ALLOWED_GOOGLE_DOMAIN is correct
#   - Ensure Google OAuth is configured properly
