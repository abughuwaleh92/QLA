<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>G7 • Unit 1 • Comparing & Simplifying Rational Numbers — QLA</title>

<!-- Fonts & Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX (robust auto-render) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
<script>
  // Boot KaTeX and expose a rerender helper for dynamically-inserted content
  window.addEventListener('DOMContentLoaded', () => {
    const run = (root=document.body) => {
      if (!window.renderMathInElement) return;
      window.renderMathInElement(root, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\[', right: '\\]', display: true },
          { left: '\\(', right: '\\)', display: false }
        ],
        throwOnError: false
      });
    };
    if (window.renderMathInElement) run();
    else {
      const t=setInterval(()=>{ if(window.renderMathInElement){ clearInterval(t); run(); }},25);
      setTimeout(()=>clearInterval(t),6000);
    }
    window._rerenderMath = run;
  });
</script>

<style>
  :root{--maroon:#6C1D45;--gold:#C7A34F;--dark:#2C2C2E;--light:#F5F5F5;--accent:#E8D5B7}
  html,body{height:100%;background:#2d3748;color:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #deck{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}
  #slides{position:relative;width:100%;max-width:1280px;aspect-ratio:16/9;background:#fff;box-shadow:0 14px 36px rgba(0,0,0,.35);overflow:hidden;border-radius:18px}

  .slide{position:absolute;inset:0;padding:3.5%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;opacity:0;transform:translateY(14px) scale(.985);transition:.55s ease;pointer-events:none}
  .slide.active{opacity:1;transform:none;pointer-events:auto}

  .bg-maroon{background-color:var(--maroon)} .text-maroon{color:var(--maroon)} .text-gold{color:var(--gold)}
  .banner{width:100%;height:110px;background:#fff center/contain no-repeat;border-bottom:3px solid var(--gold);border-radius:10px}

  .card{border:1px solid #e5e7eb;border-radius:14px;background:#fafafa}
  .chip{display:inline-flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.05);border-radius:9999px;padding:.35rem .75rem;cursor:pointer}
  .chip:hover{outline:2px solid var(--gold)}
  .btn{padding:.55rem 1rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:700}
  .btn.maroon{background:var(--maroon);color:#fff;border-color:var(--maroon)}
  .btn:hover{filter:brightness(0.98)}

  #controls{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.55);padding:.4rem .6rem;border-radius:999px;z-index:20;backdrop-filter:blur(6px)}
  #controls button{width:42px;height:42px;border-radius:999px;border:none;background:#fff;cursor:pointer;font-weight:700}
  #controls button:hover{transform:scale(1.06)}
  #counter{color:#fff;font-weight:700;min-width:84px;text-align:center}
  #progress{position:fixed;left:0;bottom:0;height:5px;width:0;background:var(--gold);z-index:30;transition:width .35s ease}
  #fsHint{position:absolute;top:10px;right:12px;color:#fff;background:rgba(0,0,0,.35);padding:.25rem .5rem;border-radius:8px;font-size:.8rem}

  .hint{background:#fff3cd;border:1px solid #ffe69c;border-radius:10px;padding:.5rem .75rem}
  .confetti{position:fixed;pointer-events:none;z-index:50}

  /* Drag sorting */
  .sortable{list-style:none;padding:0;margin:0}
  .sortable li{user-select:none;background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin:.3rem 0;padding:.6rem .8rem;cursor:grab}
  .sortable .dragging{opacity:.55;transform:scale(.98)}
</style>
</head>
<body>

<div id="deck" aria-live="polite">
  <div id="slides" class="relative">
    <div id="fsHint">Press <strong>F</strong> for fullscreen</div>

    <!-- 0 • Title -->
    <section class="slide active bg-maroon text-white" id="titleSlide">
      <div class="w-full h-16 banner mb-6 rounded-md" style="background-image:url('qla_banner.png')" aria-label="QLA Partner Banner"></div>
      <div class="flex items-center gap-8">
        <img src="qla_logo.png" alt="QLA Logo" class="h-20 w-auto" onerror="this.style.display='none'"/>
        <div class="text-left">
          <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight">Comparing &amp; Simplifying Rational Numbers</h1>
          <p class="text-gold text-2xl md:text-3xl mt-2 font-semibold">Fractions • Decimals • Mixed Numbers • Order &amp; Equivalence</p>
          <p class="mt-2 text-lg">Qatar Leadership Academy — Grade 7</p>
        </div>
      </div>
      <div class="absolute bottom-6 text-sm text-gray-100">Aligned to AERO 7.NS.1 &amp; 7.NS.2 readiness.</div>
    </section>

    <!-- 1 • Learning Objectives & Keywords -->
    <section class="slide" id="loSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Learning Objectives &amp; Keywords</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Learning Objectives</h3>
          <ul class="list-disc list-inside space-y-1 text-lg">
            <li>Write fractions in <b>simplest form</b> by dividing the numerator and denominator by a common factor (GCF when needed).</li>
            <li>Decide whether one rational number is <b>less than, greater than, or equal to</b> another using <b>common denominators</b>, <b>cross‑multiplication</b> (for positive denominators), or <b>decimal forms</b>.</li>
            <li>Order a set of rational numbers from least to greatest and justify the order.</li>
            <li>Apply comparing & simplifying in **real‑world contexts** (money, measurement, rates).</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Keywords (tap)</h3>
          <div class="flex flex-wrap gap-2 text-lg">
            <span class="chip" data-key="rat">rational number</span>
            <span class="chip" data-key="eqv">equivalent fractions</span>
            <span class="chip" data-key="simp">simplest form</span>
            <span class="chip" data-key="gcf">greatest common factor (GCF)</span>
            <span class="chip" data-key="lcd">least common denominator (LCD)</span>
            <span class="chip" data-key="cross">cross‑multiplication</span>
            <span class="chip" data-key="mixed">mixed number</span>
          </div>
          <p class="text-xs text-gray-500 mt-3">Note: use cross‑multiplication only when denominators are positive (we will generate them that way here).</p>
        </div>
      </div>
    </section>

    <!-- 2 • Tap-to-Reveal mini explanations -->
    <section class="slide" id="revealSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Tap to Reveal</h2>
      <div class="grid md:grid-cols-2 gap-6 w-full max-w-5xl text-left">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Simplifying</h3>
          <div class="space-y-2 text-lg">
            <button class="chip rev" data-t="simp1">What is “simplest form”?</button>
            <button class="chip rev" data-t="simp2">How to find a common factor?</button>
            <button class="chip rev" data-t="simp3">What if I’m not sure?</button>
            <div id="revBox1" class="mt-3"></div>
          </div>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Comparing</h3>
          <div class="space-y-2 text-lg">
            <button class="chip rev" data-t="cmp1">Common denominator method</button>
            <button class="chip rev" data-t="cmp2">Cross‑multiplication</button>
            <button class="chip rev" data-t="cmp3">Compare by decimals</button>
            <div id="revBox2" class="mt-3"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 3 • Explorer: Compare Two Fractions -->
    <section class="slide" id="exploreSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Explorer: Compare Two Fractions</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="grid md:grid-cols-2 gap-4">
          <div class="p-2">
            <div class="text-lg">Enter or randomize \( \dfrac{a}{b} \) and \( \dfrac{c}{d} \):</div>
            <div class="mt-2 flex flex-wrap gap-3 items-center">
              <span>\(a\)=<input id="ea" class="border rounded px-2 py-1 w-16" value="3"></span>
              <span>\(b\)=<input id="eb" class="border rounded px-2 py-1 w-16" value="8"></span>
              <span>\(c\)=<input id="ec" class="border rounded px-2 py-1 w-16" value="5"></span>
              <span>\(d\)=<input id="ed" class="border rounded px-2 py-1 w-16" value="12"></span>
              <button id="erand" class="btn">Random</button>
              <button id="eshow" class="btn maroon">Show steps</button>
            </div>
            <div id="esteps" class="mt-3 text-lg"></div>
          </div>
          <div class="p-2">
            <div class="text-lg mb-2">Pick the correct symbol:</div>
            <div class="text-2xl">
              \( \dfrac{a}{b} \)\(<span id="eA"></span>\) 
              <select id="esign" class="border rounded px-2 py-1 mx-1">
                <option value="?">?</option>
                <option value="<">&lt;</option>
                <option value=">">&gt;</option>
                <option value="=">=</option>
              </select>
              \( \dfrac{c}{d} \)\(<span id="eB"></span>\)
            </div>
            <div class="mt-3 flex gap-2">
              <button id="echeck" class="btn maroon">Check</button>
              <button id="ereset" class="btn">Reset</button>
              <button id="eExportCSV" class="btn">Export CSV</button>
              <button id="eExportJSON" class="btn">Export JSON</button>
            </div>
            <div id="efb" class="mt-2 h-6 font-semibold"></div>
          </div>
        </div>
        <div class="hint mt-3 text-sm">Tip: With positive denominators, compare \( \dfrac{a}{b} \) and \( \dfrac{c}{d} \) by comparing \(ad\) and \(bc\). The larger product tells you the larger fraction.</div>
      </div>
    </section>

    <!-- 4 • Simplify Coach (step-by-step) -->
    <section class="slide" id="coachSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Simplify Coach</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="text-lg">Reduce a fraction step by step. Divide top & bottom by the <b>same</b> number.</div>
        <div class="mt-3 flex flex-wrap items-center gap-3">
          <span>\( \dfrac{\)\(<input id="sa" class="border rounded px-2 py-1 w-20" value="84">\)\(}{\)\(<input id="sb" class="border rounded px-2 py-1 w-20" value="126">\)\(} \)</span>
          <span>÷ by <input id="sstep" class="border rounded px-2 py-1 w-20" placeholder="e.g., 2 or 3"></span>
          <button id="sapply" class="btn maroon">Apply</button>
          <button id="shint" class="btn">Hint</button>
          <button id="sreset" class="btn">New</button>
          <button id="sExportCSV" class="btn">Export CSV</button>
          <button id="sExportJSON" class="btn">Export JSON</button>
        </div>
        <div id="sout" class="mt-3 text-xl"></div>
      </div>
    </section>

    <!-- 5 • Practice: Simplify to simplest form -->
    <section class="slide" id="simpSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Practice: Simplify to Simplest Form</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="flex items-center gap-3">
          <span>Level:</span>
          <select id="sfLevel" class="border rounded px-2 py-1">
            <option value="easy">easy (small, positive)</option>
            <option value="med" selected>medium (larger, mixed)</option>
            <option value="hard">hard (negatives / bigger)</option>
          </select>
          <button id="sfNew" class="btn">New set</button>
          <button id="sfExportCSV" class="btn">Export CSV</button>
          <button id="sfExportJSON" class="btn">Export JSON</button>
        </div>
        <div id="sfList" class="grid md:grid-cols-2 gap-3 mt-3"></div>
        <div class="mt-3">
          <button id="sfCheck" class="btn maroon">Check</button>
          <div id="sfFb" class="mt-2 h-6 font-semibold"></div>
        </div>
      </div>
    </section>

    <!-- 6 • Practice: Compare Pairs -->
    <section class="slide" id="cmpSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Practice: Compare Pairs</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="flex items-center gap-3">
          <span>Level:</span>
          <select id="cpLevel" class="border rounded px-2 py-1">
            <option value="easy">easy (like denominators / simple decimals)</option>
            <option value="med" selected>medium (unlike denominators)</option>
            <option value="hard">hard (negatives / mixed)</option>
          </select>
          <button id="cpNew" class="btn">New set</button>
          <button id="cpExportCSV" class="btn">Export CSV</button>
          <button id="cpExportJSON" class="btn">Export JSON</button>
        </div>
        <div id="cpList" class="grid md:grid-cols-2 gap-3 mt-3"></div>
        <div class="mt-3">
          <button id="cpCheck" class="btn maroon">Check</button>
          <div id="cpFb" class="mt-2 h-6 font-semibold"></div>
        </div>
      </div>
    </section>

    <!-- 7 • Practice: Order from Least to Greatest (drag to sort) -->
    <section class="slide" id="orderSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Order from Least to Greatest</h2>
      <div class="card p-5 w-full max-w-4xl text-left">
        <div class="flex items-center gap-3">
          <button id="orNew" class="btn">New set</button>
          <button id="orExportCSV" class="btn">Export CSV</button>
          <button id="orExportJSON" class="btn">Export JSON</button>
        </div>
        <ul id="orList" class="sortable mt-3"></ul>
        <div class="mt-3">
          <button id="orCheck" class="btn maroon">Check</button>
          <div id="orFb" class="mt-2 h-6 font-semibold"></div>
        </div>
      </div>
    </section>

    <!-- 8 • Real-World Practice -->
    <section class="slide" id="realSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Real‑World Practice</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div id="realList" class="grid md:grid-cols-2 gap-3"></div>
        <div class="mt-3 flex gap-2">
          <button id="realNew" class="btn">New set</button>
          <button id="realCheck" class="btn maroon">Check</button>
          <button id="realExportCSV" class="btn">Export CSV</button>
          <button id="realExportJSON" class="btn">Export JSON</button>
        </div>
        <div id="realFb" class="mt-2 h-6 font-semibold"></div>
      </div>
    </section>

    <!-- 9 • Challenge Mode -->
    <section class="slide" id="challengeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Challenge Mode</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="flex items-center gap-3">
          <span>Level:</span>
          <select id="chLevel" class="border rounded px-2 py-1">
            <option value="easy">easy</option>
            <option value="med" selected>medium</option>
            <option value="hard">hard</option>
          </select>
          <button id="chNew" class="btn">New question</button>
          <span class="chip">Streak: <b id="streakOut">0</b></span>
          <button id="chExportCSV" class="btn">Export CSV</button>
          <button id="chExportJSON" class="btn">Export JSON</button>
        </div>
        <div class="mt-3 text-2xl">Task: <span id="chText" class="font-extrabold"></span></div>
        <div class="mt-2">
          <input id="chAns" class="border rounded px-3 py-2 w-60" placeholder="answer"/>
          <button id="chCheck" class="btn maroon">Check</button>
          <button id="chHint" class="btn">Hint</button>
        </div>
        <div id="chHintBox" class="mt-3 text-sm"></div>
        <div id="chFb" class="mt-2 h-6 font-semibold"></div>
      </div>
    </section>

    <!-- 10 • Exit -->
    <section class="slide" id="exitSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Exit Ticket &amp; Next Steps</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">3–2–1 Reflect</h3>
          <ul class="list-disc list-inside">
            <li>3 ways to compare rationals you can explain</li>
            <li>2 fractions you simplified today (and how)</li>
            <li>1 question you still have</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">Up Next</h3>
          <p><b>Prime Factorization Toolkit</b> (Factors/Multiples • Prime/Composite • Factor Trees • HCF/LCM) to turbo‑charge simplifying and common denominators.</p>
        </div>
      </div>
      <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[88%] h-[100px] banner rounded-md" style="background-image:url('qla_banner.png')"></div>
    </section>

  </div>
</div>

<!-- Controls -->
<div id="controls" role="group" aria-label="Slideshow controls">
  <button id="prev" title="Previous (←)">&laquo;</button>
  <button id="fs" title="Toggle Fullscreen (F)">⤢</button>
  <div id="counter">1 / 11</div>
  <button id="next" title="Next (→)">&raquo;</button>
</div>
<div id="progress"></div>

<!-- Glossary popover -->
<div id="pop" role="dialog" aria-modal="true" aria-live="polite">
  <span class="close" title="Close">✕</span>
  <div id="popBody"></div>
</div>

<script>
/* ======================= Helpers & Navigation ======================= */
(function(){
  const slides=[...document.querySelectorAll('.slide')];
  const prev=id('prev'), next=id('next'), counter=id('counter'), progress=id('progress'), fsBtn=id('fs');
  const deckTitle='G7_Comparing_Simplifying_Rationals';
  let i=0;

  function id(x){return document.getElementById(x)}
  function renderMath(root=document){ if(window._rerenderMath) window._rerenderMath(root); }
  function confetti(x=window.innerWidth/2,y=window.innerHeight/2){
    for(let k=0;k<20;k++){
      const d=document.createElement('div'); d.className='confetti';
      d.style.left=x+'px'; d.style.top=y+'px'; d.style.width='8px'; d.style.height='8px';
      d.style.background=['#6C1D45','#C7A34F','#E8D5B7','#8a3d64'][k%4];
      document.body.appendChild(d);
      const dx=(Math.random()*2-1)*240, dy=(Math.random()*-1-0.3)*300, rot=Math.random()*720;
      d.animate([{transform:'translate(0,0) rotate(0deg)'},{transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}],
                {duration:900+Math.random()*700,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>d.remove();
    }
  }
  function downloadJSON(filename, data){
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function downloadCSV(filename, rows){
    const csv=rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  function show(k){
    i=(k+slides.length)%slides.length;
    slides.forEach((s,idx)=>s.classList.toggle('active',idx===i));
    counter.textContent=(i+1)+' / '+slides.length;
    progress.style.width=((i+1)/slides.length*100)+'%';
    renderMath(slides[i]);
  }
  prev.addEventListener('click',()=>show(i-1));
  next.addEventListener('click',()=>show(i+1));
  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') show(i+1);
    if(e.key==='ArrowLeft') show(i-1);
    if(e.key.toLowerCase()==='f') toggleFS();
  });
  function toggleFS(){
    const el=id('slides');
    if(!document.fullscreenElement){(el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen).call(el);}
    else{(document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document);}
  }
  fsBtn.addEventListener('click',toggleFS);

  /* ---------------------- Glossary popover ----------------------- */
  const POP=id('pop'), POP_BODY=id('popBody');
  const GLOS={
    rat:'<strong>Rational number</strong>: any number that can be written as \\(\\tfrac ab\\) with integers a,b and b\\(\\ne\\)0 (includes terminating & repeating decimals).',
    eqv:'<strong>Equivalent fractions</strong>: represent the same value (e.g., \\(\\tfrac{2}{3}=\\tfrac{8}{12}\\)).',
    simp:'<strong>Simplest form</strong>: numerator & denominator share no common factor other than 1.',
    gcf:'<strong>GCF</strong>: the largest positive integer that divides both numbers.',
    lcd:'<strong>LCD</strong>: a common denominator useful for addition/subtraction and comparing.',
    cross:'<strong>Cross‑multiplication</strong>: for \\(\\tfrac ab\\) vs \\(\\tfrac cd\\) with b,d>0, compare ad and bc.',
    mixed:'<strong>Mixed number</strong>: a whole number plus a proper fraction (e.g., \\(2\\tfrac{1}{3}\\)).'
  };
  POP.querySelector('.close').addEventListener('click',()=>POP.style.display='none');
  document.addEventListener('click',e=>{
    const el=e.target.closest('.chip[data-key]'); if(!el) return;
    const key=el.dataset.key; if(!GLOS[key]) return;
    POP_BODY.innerHTML=GLOS[key]; POP.style.display='block';
    const r=el.getBoundingClientRect();
    POP.style.left=Math.min(r.left, window.innerWidth-POP.offsetWidth-20)+'px';
    POP.style.bottom=(window.innerHeight-r.top+10)+'px';
    renderMath(POP_BODY);
  });

  /* ---------------------- Tap-to-reveal content ----------------------- */
  const REV1={
    simp1:'“Simplest form” means the numerator & denominator have no common factor > 1.',
    simp2:'Use divisibility tests: even → divide by 2; sum of digits multiple of 3 → divide by 3; ends in 0 or 5 → divide by 5; etc.',
    simp3:'If unsure, repeat small factors (2,3,5) or find the GCF and divide once.'
  };
  const REV2={
    cmp1:'Find a common denominator, make equivalent fractions, then compare numerators.',
    cmp2:'With positive denominators, compare \\(ad\\) and \\(bc\\). Larger product ↔ larger fraction.',
    cmp3:'Sometimes converting to decimals is quick (e.g., \\(\\tfrac{3}{4}=0.75\\)).'
  };
  document.addEventListener('click',e=>{
    const r=e.target.closest('.rev'); if(r){const target=r.dataset.t; const text=(REV1[target]||REV2[target]||''); (REV1[target]?id('revBox1'):id('revBox2')).innerHTML='<div class="hint">'+text+'</div>';}
  });

  /* ====================== Math utilities ======================== */
  const gcd=(a,b)=>{a=Math.trunc(Math.abs(a));b=Math.trunc(Math.abs(b));while(b){[a,b]=[b,a%b]}return a||1};
  const simplify=(n,d)=>{let g=gcd(n,d); if(d<0) g=-g; return [n/g,d/g];}
  const toLatex=(n,d)=> d===1? String(n):`\\dfrac{${n}}{${d}}`;
  function randomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
  function randFrom(arr){return arr[Math.floor(Math.random()*arr.length)]}
  function nonzeroRand(a,b){let x=0; while(x===0){x=randomInt(a,b)} return x}
  function equivalent(n,d,k){return [n*k,d*k]}

  /* ======================= Explorer: Compare ====================== */
  const ea=id('ea'), eb=id('eb'), ec=id('ec'), ed=id('ed'), esign=id('esign'), eA=id('eA'), eB=id('eB');
  function explorerRender(){
    eA.textContent=''; eB.textContent='';
    id('esteps').innerHTML='';
    esign.value='?';
    renderMath(id('exploreSlide'));
  }
  id('erand').addEventListener('click',()=>{
    ea.value=nonzeroRand(1,9); eb.value=randomInt(2,12);
    ec.value=nonzeroRand(1,9); ed.value=randomInt(2,12);
    explorerRender();
  });
  id('ereset').addEventListener('click',()=>{ea.value=3; eb.value=8; ec.value=5; ed.value=12; explorerRender();});
  id('eshow').addEventListener('click',()=>{
    const a=Number(ea.value), b=Number(eb.value), c=Number(ec.value), d=Number(ed.value);
    if(!Number.isFinite(a*b*c*d) || b<=0 || d<=0){ id('esteps').innerHTML='<span class="text-red-700">Enter integers; denominators must be positive.</span>'; return;}
    const ad=a*d, bc=b*c;
    id('esteps').innerHTML=`Cross‑products: \\(ad=${ad}\\), \\(bc=${bc}\\).<br>
    So \\(\\dfrac{${a}}{${b}}\\) is ${ad>bc? 'greater than' : ad<bc? 'less than' : 'equal to'} \\(\\dfrac{${c}}{${d}}\\).`;
    renderMath(id('exploreSlide'));
  });
  id('echeck').addEventListener('click',()=>{
    const a=Number(ea.value), b=Number(eb.value), c=Number(ec.value), d=Number(ed.value); const s=esign.value;
    if(s==='?'){ id('efb').textContent='Choose a symbol.'; id('efb').className='mt-2 h-6 font-semibold text-red-700'; return;}
    const ad=a*d, bc=b*c; const truth = (s==='<')? ad<bc : (s==='>')? ad>bc : ad===bc;
    if(truth){ id('efb').textContent='✅ Correct!'; id('efb').className='mt-2 h-6 font-semibold text-green-700'; confetti();}
    else { id('efb').textContent='❌ Not quite. Use the Show steps button.'; id('efb').className='mt-2 h-6 font-semibold text-red-700';}
  });
  id('eExportCSV').addEventListener('click',()=>{
    downloadCSV(`${deckTitle}_explorer.csv`, [['a','b','c','d','userSign'], [ea.value, eb.value, ec.value, ed.value, esign.value]]);
  });
  id('eExportJSON').addEventListener('click',()=>{
    downloadJSON(`${deckTitle}_explorer.json`, {a:Number(ea.value), b:Number(eb.value), c:Number(ec.value), d:Number(ed.value), userSign:esign.value});
  });

  /* ====================== Simplify Coach ========================= */
  const sa=id('sa'), sb=id('sb'), sstep=id('sstep'), sout=id('sout');
  function coachRender(){
    const a=Number(sa.value), b=Number(sb.value);
    if(!Number.isFinite(a*b) || b===0){sout.innerHTML='<span class="text-red-700">Enter integers; denominator ≠ 0.</span>'; return;}
    const [n,d]=simplify(a,b);
    sout.innerHTML=`Current: \\( ${toLatex(a,b)} \\). Simplest form is \\( ${toLatex(n,d)} \\).`;
    renderMath(id('coachSlide'));
  }
  coachRender();
  id('sapply').addEventListener('click',()=>{
    let a=Number(sa.value), b=Number(sb.value), k=Number(sstep.value);
    if(!Number.isFinite(a*b*k) || k===0){sout.innerHTML='<span class="text-red-700">Enter a valid non‑zero step.</span>'; return;}
    if(a%k===0 && b%k===0){ a/=k; b/=k; sa.value=a; sb.value=b; sout.innerHTML=`Good! New fraction: \\( ${toLatex(a,b)} \\).`; }
    else{ sout.innerHTML=`<span class="text-red-700">That step does not divide both. Try another number.</span>`; }
    renderMath(id('coachSlide'));
  });
  id('shint').addEventListener('click',()=>{
    const a=Number(sa.value), b=Number(sb.value);
    const tests=[2,3,5,7];
    const hint=tests.find(t=>a%t===0 && b%t===0);
    sout.innerHTML = hint ? `<div class="hint">Try dividing by ${hint}.</div>` : `<div class="hint">Look for any common factor. If none of 2,3,5,7 work, try GCF = ${gcd(a,b)}.</div>`;
    renderMath(id('coachSlide'));
  });
  id('sreset').addEventListener('click',()=>{
    sa.value=randomInt(20,200); sb.value=randomInt(20,200); coachRender();
  });
  id('sExportCSV').addEventListener('click',()=>downloadCSV(`${deckTitle}_coach.csv`, [['a','b','gcf'], [sa.value, sb.value, gcd(Number(sa.value),Number(sb.value))]]));
  id('sExportJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_coach.json`, {a:Number(sa.value), b:Number(sb.value), gcf:gcd(Number(sa.value),Number(sb.value))}));

  /* ====================== Practice: Simplify ===================== */
  const sfState={items:[]};
  function newSimpSet(){
    const lv=id('sfLevel').value; let items=[];
    for(let k=0;k<6;k++){
      let a,b;
      if(lv==='easy'){ a=randomInt(6,40); b=randomInt(6,40);}
      else if(lv==='med'){ a=randomInt(10,180); b=randomInt(10,180);}
      else { a=nonzeroRand(-180,180); b=nonzeroRand(10,220); if(a===0) a=nonzeroRand(-180,180);}
      // ensure reducible half of the time
      if(Math.random()<0.5){ const t=randFrom([2,3,4,5,6,7]); [a,b]=equivalent(a,b,t); }
      items.push([a,b]);
    }
    sfState.items=items;
    const box=id('sfList'); box.innerHTML='';
    items.forEach((fr,idx)=>{
      const [a,b]=fr; const row=document.createElement('div'); row.className='card p-4';
      row.innerHTML=`<div class="text-left font-semibold text-maroon">Item ${idx+1}</div>
        <div class="text-xl mt-1">\\( ${toLatex(a,b)} = \\)
          <input class="sfn border rounded px-2 py-1 w-20" placeholder="num"> /
          <input class="sfd border rounded px-2 py-1 w-20" placeholder="den">
        </div>`;
      box.appendChild(row);
    });
    renderMath(id('simpSlide'));
  }
  id('sfNew').addEventListener('click',newSimpSet); newSimpSet();
  id('sfCheck').addEventListener('click',()=>{
    let ok=0; const rows=[...document.querySelectorAll('#sfList .card')];
    rows.forEach((row,idx)=>{
      const [a,b]=sfState.items[idx]; const want=simplify(a,b);
      const n=Number(row.querySelector('.sfn').value), d=Number(row.querySelector('.sfd').value);
      const got=simplify(n,d);
      const good=(got[0]===want[0] && got[1]===want[1]);
      row.querySelector('.sfn').style.borderColor=good?'#22c55e':'#ef4444';
      row.querySelector('.sfd').style.borderColor=good?'#22c55e':'#ef4444'; if(good) ok++;
    });
    id('sfFb').textContent = ok===rows.length? '✅ All in simplest form!' : `Score: ${ok}/${rows.length}`;
    if(ok===rows.length) confetti();
  });
  id('sfExportCSV').addEventListener('click',()=>{
    const rows=[['orig','simp_num','simp_den','user_num','user_den']]; sfState.items.forEach((fr,idx)=>{
      const want=simplify(fr[0],fr[1]); const card=document.querySelectorAll('#sfList .card')[idx];
      rows.push([`${fr[0]}/${fr[1]}`, want[0], want[1], card.querySelector('.sfn').value||'', card.querySelector('.sfd').value||'']);
    }); downloadCSV(`${deckTitle}_simplify.csv`, rows);
  });
  id('sfExportJSON').addEventListener('click',()=>{
    const data=sfState.items.map((fr,idx)=>{ const want=simplify(fr[0],fr[1]); const card=document.querySelectorAll('#sfList .card')[idx]; return {orig:`${fr[0]}/${fr[1]}`, simp:{n:want[0],d:want[1]}, user:{n:card.querySelector('.sfn').value||'', d:card.querySelector('.sfd').value||''}};});
    downloadJSON(`${deckTitle}_simplify.json`, data);
  });

  /* ====================== Practice: Compare Pairs ================= */
  const cpState={items:[]};
  function toPairLatex(a,b,c,d){return `\\\\( ${toLatex(a,b)} \\\\ ? \\\\ ${toLatex(c,d)} \\\\)`;}
  function newCmpSet(){
    const lv=id('cpLevel').value; const items=[];
    for(let k=0;k<6;k++){
      let a,b,c,d;
      if(lv==='easy'){ b=randFrom([4,5,6,8,10,12]); d=b; a=randomInt(1,b-1); c=randomInt(1,b-1); }
      else if(lv==='med'){ b=randFrom([4,5,6,7,8,9,10,12]); d=randFrom([4,5,6,7,8,9,10,12]); a=randomInt(1,b*2-1); c=randomInt(1,d*2-1);}
      else { b=randFrom([6,7,8,10,12,14]); d=randFrom([5,7,9,11,13]); a=nonzeroRand(-10,20); c=nonzeroRand(-10,20);}
      // Avoid zero denominators
      if(b===0) b=4; if(d===0) d=5;
      items.push([a,b,c,d]);
    }
    cpState.items=items;
    const box=id('cpList'); box.innerHTML='';
    items.forEach((p,idx)=>{
      const [a,b,c,d]=p; const row=document.createElement('div'); row.className='card p-4';
      row.innerHTML=`<div class="text-left font-semibold text-maroon">Item ${idx+1}</div>
        <div class="text-2xl mt-1">\\( ${toLatex(a,b)} \\)
          <select class="cpsel border rounded px-2 py-1 mx-1">
            <option value="?">?</option><option value="<">&lt;</option><option value=">">&gt;</option><option value="=">=</option>
          </select>
          \\( ${toLatex(c,d)} \\)
        </div>`;
      box.appendChild(row);
    });
    renderMath(id('cmpSlide'));
  }
  id('cpNew').addEventListener('click',newCmpSet); newCmpSet();
  id('cpCheck').addEventListener('click',()=>{
    let ok=0; const rows=[...document.querySelectorAll('#cpList .card')];
    rows.forEach((row,idx)=>{
      const [a,b,c,d]=cpState.items[idx]; const sel=row.querySelector('.cpsel').value;
      if(sel==='?'){ row.querySelector('.cpsel').style.borderColor='#ef4444'; return;}
      const ad=a*d, bc=b*c; const truth=(sel==='<')? ad<bc : (sel==='>')? ad>bc : ad===bc;
      row.querySelector('.cpsel').style.borderColor = truth?'#22c55e':'#ef4444'; if(truth) ok++;
    });
    id('cpFb').textContent = ok===rows.length? '✅ All comparisons correct!' : `Score: ${ok}/${rows.length}`;
    if(ok===rows.length) confetti();
  });
  id('cpExportCSV').addEventListener('click',()=>{
    const rows=[['a','b','c','d','user','truth']]; document.querySelectorAll('#cpList .card').forEach((row,idx)=>{
      const [a,b,c,d]=cpState.items[idx]; const sel=row.querySelector('.cpsel').value; const ad=a*d, bc=b*c; const truth = ad<bc?'<': ad>bc?'>':'=';
      rows.push([a,b,c,d,sel,truth]);
    }); downloadCSV(`${deckTitle}_compare.csv`, rows);
  });
  id('cpExportJSON').addEventListener('click',()=>{
    const data=[...document.querySelectorAll('#cpList .card')].map((row,idx)=>{ const [a,b,c,d]=cpState.items[idx]; const ad=a*d, bc=b*c; return {a,b,c,d, truth: ad<bc?'<': ad>bc?'>':'=', user: row.querySelector('.cpsel').value}; });
    downloadJSON(`${deckTitle}_compare.json`, data);
  });

  /* ====================== Order (drag & drop) ===================== */
  const orState={items:[]};
  function newOrderSet(){
    const items=[];
    for(let i=0;i<6;i++){
      const type=Math.random();
      if(type<.5){ const d=randFrom([4,5,6,7,8,10,12]); const n=randomInt(-2*d,2*d); items.push({n,d}); }
      else { // simple decimals as fractions out of 100
        const sign=Math.random()<.5?-1:1; const v=sign*(randomInt(1,175))/100; // up to 2 decimals
        // convert to fraction out of 100
        const n=Math.round(v*100), d=100; items.push({n,d});
      }
    }
    orState.items=items;
    const ul=id('orList'); ul.innerHTML='';
    items.forEach((fr,idx)=>{
      const li=document.createElement('li'); li.draggable=true; li.dataset.idx=idx; li.innerHTML=`<span class="handle mr-2">↕</span> \\( ${toLatex(fr.n,fr.d)} \\)`; ul.appendChild(li);
    });
    renderMath(id('orderSlide'));
    makeSortable(ul);
  }
  function makeSortable(ul){
    let dragging=null;
    ul.querySelectorAll('li').forEach(li=>{
      li.addEventListener('dragstart',e=>{ dragging=li; li.classList.add('dragging'); });
      li.addEventListener('dragend',e=>{ dragging=null; li.classList.remove('dragging'); });
    });
    ul.addEventListener('dragover',e=>{
      e.preventDefault();
      const after=[...ul.querySelectorAll('li:not(.dragging)')].find(li=>e.clientY<li.getBoundingClientRect().top+li.offsetHeight/2);
      if(after) ul.insertBefore(dragging, after); else ul.appendChild(dragging);
    });
  }
  id('orNew').addEventListener('click',newOrderSet); newOrderSet();
  id('orCheck').addEventListener('click',()=>{
    const lis=[...id('orList').children]; const frs=lis.map(li=>orState.items[Number(li.dataset.idx)]);
    const good=frs.every((fr,idx,arr)=> idx===0 || arr[idx-1].n*fr.d <= fr.n*arr[idx-1].d );
    id('orFb').textContent = good? '✅ Correct order!' : '❌ Not quite. Try again.';
    id('orFb').className='mt-2 h-6 font-semibold '+(good?'text-green-700':'text-red-700'); if(good) confetti();
  });
  id('orExportCSV').addEventListener('click',()=>{
    const lis=[...id('orList').children]; const seq=lis.map(li=>toLatex(orState.items[li.dataset.idx].n, orState.items[li.dataset.idx].d));
    downloadCSV(`${deckTitle}_order.csv`, [['sequence'], [seq.join(' < ')]]);
  });
  id('orExportJSON').addEventListener('click',()=>{
    const lis=[...id('orList').children]; const seq=lis.map(li=>orState.items[li.dataset.idx]); downloadJSON(`${deckTitle}_order.json`, seq);
  });

  /* ====================== Real‑World Practice ===================== */
  const realState={items:[]};
  function realNew(){
    const items=[];
    items.push({q:`Two juice recipes: A uses \\(\\tfrac{3}{5}\\) orange, B uses \\(\\tfrac{5}{9}\\). Which has a <b>larger</b> orange part?`, options:['A','B','Same'], ans:'A', explain:'Compare cross‑products: 3·9=27 vs 5·5=25 → A is larger.'});
    items.push({q:`Which is a <b>better discount</b>: 15% off or \\(\\tfrac{1}{6}\\) off?`, options:['15%','1/6','Same'], ans:'1/6', explain:'1/6≈16.7% which is bigger than 15%.'});
    items.push({q:`A runner covers \\(\\tfrac{7}{10}\\) km per minute; another covers 0.68 km per minute. Who is faster?`, options:['First','Second','Same'], ans:'First', explain:'0.7 km/min vs 0.68 km/min → first is faster.'});
    items.push({q:`Bank balances: \\(-\\tfrac{9}{4}\\) thousand QAR vs \\(-2.1\\) thousand QAR. Which balance is <b>higher</b>?`, options:['-9/4','-2.1','Same'], ans:'-2.1', explain:'-2.25 vs -2.1 → -2.1 is greater (less negative).'});
    realState.items=items;
    const box=id('realList'); box.innerHTML='';
    items.forEach((o,idx)=>{
      const row=document.createElement('div'); row.className='card p-4';
      row.innerHTML=`<div class="text-xl">${o.q}</div>
        <div class="mt-1">${o.options.map(op=>`<label class="mr-3"><input type="radio" name="rw${idx}" value="${op}"> ${op}</label>`).join(' ')}</div>
        <div class="text-sm text-gray-600 mt-1">Explain: ${o.explain}</div>`;
      box.appendChild(row);
    });
    renderMath(id('realSlide'));
  }
  id('realNew').addEventListener('click',realNew); realNew();
  id('realCheck').addEventListener('click',()=>{
    let ok=0; realState.items.forEach((o,idx)=>{ const sel=(document.querySelector(`input[name="rw${idx}"]:checked`)||{}).value||''; if(sel===o.ans) ok++;});
    id('realFb').textContent = ok===realState.items.length? '✅ Real‑world ready!' : `Score: ${ok}/${realState.items.length}`;
    if(ok===realState.items.length) confetti();
  });
  id('realExportCSV').addEventListener('click',()=>{
    const rows=[['question','answer','user']]; realState.items.forEach((o,idx)=>{ const sel=(document.querySelector(`input[name="rw${idx}"]:checked`)||{}).value||''; rows.push([o.q,o.ans,sel]);}); downloadCSV(`${deckTitle}_realworld.csv`, rows);
  });
  id('realExportJSON').addEventListener('click',()=>{
    const data=realState.items.map((o,idx)=>({q:o.q, ans:o.ans, user:(document.querySelector(`input[name="rw${idx}"]:checked`)||{}).value||''}));
    downloadJSON(`${deckTitle}_realworld.json`, data);
  });

  /* ====================== Challenge Mode ========================= */
  const chState={cur:null, streak:0, history:[]};
  function chNew(){
    const lv=id('chLevel').value; let prompt='', ans='';
    if(lv==='easy'){
      const b=randFrom([6,8,10,12]); const a=randomInt(1,b-1); const k=randFrom([2,3,4,5]);
      const [n,d]=equivalent(a,b,k); prompt=`Reduce \\( ${toLatex(n,d)} \\) to simplest form`; ans=toLatex(...simplify(n,d));
    } else if(lv==='med'){
      const b=randFrom([7,8,9,10,11,12]); const d=randFrom([6,8,10,12,14]); const a=randomInt(1,2*b-1); const c=randomInt(1,2*d-1);
      prompt=`Fill in \\( \\dfrac{${a}}{${b}} \\ ? \\ \\dfrac{${c}}{${d}} \\): type <, >, or =`; ans=(a*d<c*b)?'<':(a*d>c*b)?'>':'=';
    } else {
      // Missing numerator: n/den ? target
      const den=randFrom([12,15,16,20,24]); const tnum=randomInt(3,den-1), tden=den; // target with same den for clarity
      const sign=randFrom(['>','<']); const rhs=[tnum,tden]; // we want find integer n 0..den
      prompt=`Find an integer \\(n\\) so that \\( \\dfrac{n}{${den}} ${sign} \\dfrac{${rhs[0]}}{${rhs[1]}} \\). Type n`;
      ans = sign==='>' ? String(tnum+1) : String(tnum-1);
    }
    chState.cur={prompt,ans}; id('chText').innerHTML=prompt; id('chAns').value=''; id('chFb').textContent=''; id('chHintBox').textContent=''; renderMath(id('challengeSlide'));
  }
  id('chNew').addEventListener('click',chNew); chNew();
  id('chHint').addEventListener('click',()=>{ id('chHintBox').innerHTML=`<div class="hint">Use GCF to simplify; for comparisons with positive denominators, compare cross‑products.</div>`;});
  id('chCheck').addEventListener('click',()=>{
    const got=id('chAns').value.trim(); const want=String(chState.cur.ans);
    const ok = (got===want);
    if(ok){ chState.streak++; id('chFb').textContent='✅ Correct!'; id('chFb').className='mt-2 h-6 font-semibold text-green-700'; confetti(); chState.history.push({prompt:chState.cur.prompt, ans:want, correct:true}); chNew();}
    else { chState.streak=0; id('chFb').textContent='❌ Not quite.'; id('chFb').className='mt-2 h-6 font-semibold text-red-700'; chState.history.push({prompt:chState.cur.prompt, ans:want, correct:false}); }
    id('streakOut').textContent=chState.streak;
  });
  id('chExportCSV').addEventListener('click',()=>{
    const rows=[['prompt','answer','correct']]; chState.history.forEach(h=>rows.push([h.prompt,h.ans,h.correct])); downloadCSV(`${deckTitle}_challenge.csv`, rows);
  });
  id('chExportJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_challenge.json`, chState.history));

  /* ----------------------- Init ----------------------- */
  show(0);
})();
</script>
</body>
</html>
